{"version":"NotebookV1","origId":1416903359406703,"name":"2-2 M&M Count","language":"python","commands":[{"version":"CommandV1","origId":1416903359406704,"guid":"ad3467b6-1474-4560-b15c-98802c5af014","subtype":"command","commandType":"auto","position":1.0,"command":"\n%md\n## Example 2-1 M&M Count","commandVersion":0,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"nuid":"39e9137a-8f34-4a0c-acc7-f9bae9c47408"},{"version":"CommandV1","origId":1416903359406705,"guid":"75cfe0e4-72c0-4865-a6c4-022b7d260230","subtype":"command","commandType":"auto","position":2.0,"command":"from pyspark.sql.functions import *\n\nmnm_file = \"/databricks-datasets/learning-spark-v2/mnm_dataset.csv\"","commandVersion":0,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"nuid":"75660698-938f-4a4d-8208-7a021ed4b8ac"},{"version":"CommandV1","origId":1416903359406706,"guid":"029e75e4-3e9d-4dec-b2f7-cbc98dabf6f1","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n### Read from the CSV and infer the schema","commandVersion":0,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"nuid":"6f82cf33-9f22-4ce2-9b1f-b51b314d0a26"},{"version":"CommandV1","origId":1416903359406707,"guid":"e22aa751-2cb3-4d83-bcd1-16956e693a82","subtype":"command","commandType":"auto","position":4.0,"command":"mnm_df = (spark\n          .read\n          .format(\"csv\")\n          .option(\"header\", \"true\")\n          .option(\"inferSchema\", \"true\")\n          .load(mnm_file))\n\ndisplay(mnm_df)","commandVersion":0,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"354","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"nuid":"74d7bc0b-7287-457c-bb93-2e3b29edd27b"},{"version":"CommandV1","origId":1416903359406708,"guid":"15528cde-99a5-42f6-b5e9-7e1655964c6a","subtype":"command","commandType":"auto","position":5.0,"command":"%md\n### Aggregate count of all colors and groupBy state and color, orderBy descending order","commandVersion":0,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"nuid":"21d5a1a2-b29f-4d51-80aa-da580b625164"},{"version":"CommandV1","origId":1416903359406709,"guid":"50a68722-08f0-4913-ab42-a0afc8e26b6e","subtype":"command","commandType":"auto","position":6.0,"command":"count_mnm_df = (mnm_df\n                .select(\"State\", \"Color\", \"Count\")\n                .groupBy(\"State\", \"Color\")\n                .agg(count(\"Count\").alias(\"Total\"))\n                .orderBy(\"Total\", ascending=False))\n\ncount_mnm_df.show(n=60, truncate=False)\nprint(f\"Total Rows = {count_mnm_df.count()}\")","commandVersion":10,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"nuid":"baa30c51-7685-489e-83de-0fe19af5817a"},{"version":"CommandV1","origId":1416903359406710,"guid":"7000dcd4-38a7-458f-8812-6eb4984e7061","subtype":"command","commandType":"auto","position":7.0,"command":"%md\n### Find the aggregate count for California by filtering on State","commandVersion":0,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"nuid":"5a4d0665-477c-43b6-9ad8-590f02b0c8b4"},{"version":"CommandV1","origId":1416903359406711,"guid":"411dd8c8-b79d-4995-8ea4-6c8d3cd31be9","subtype":"command","commandType":"auto","position":8.0,"command":"ca_count_mnm_df = (mnm_df\n                   .select(\"State\", \"Color\", \"Count\") \n                   .where(mnm_df.State == \"CA\") \n                   .groupBy(\"State\", \"Color\") \n                   .agg(count(\"Count\").alias(\"Total\")) \n                   .orderBy(\"Total\", ascending=False))\n\nca_count_mnm_df.show(n=10, truncate=False)","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"nuid":"e06ea97d-1282-4dc5-a45e-e14505ef510b"}],"dashboards":[],"guid":"52f2bc7b-bae9-4631-bea9-ba15fbd05065","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2}}